syntax = "proto3";

package exec;

option go_package = "github.com/onkernel/hypeman/lib/exec";

// ExecService provides remote command execution in guest VMs
service ExecService {
  // Exec executes a command with bidirectional streaming
  rpc Exec(stream ExecRequest) returns (stream ExecResponse);
}

// ExecRequest represents messages from client to server
message ExecRequest {
  oneof request {
    ExecStart start = 1;      // Initial exec request
    bytes stdin = 2;          // Stdin data
  }
}

// ExecStart initiates command execution
message ExecStart {
  repeated string command = 1;        // Command and arguments
  bool tty = 2;                       // Allocate pseudo-TTY
  map<string, string> env = 3;        // Environment variables
  string cwd = 4;                     // Working directory (optional)
  int32 timeout_seconds = 5;          // Execution timeout in seconds (0 = no timeout)
}

// ExecResponse represents messages from server to client
message ExecResponse {
  oneof response {
    bytes stdout = 1;     // Stdout data
    bytes stderr = 2;     // Stderr data
    int32 exit_code = 3;  // Command exit code (final message)
  }
}

